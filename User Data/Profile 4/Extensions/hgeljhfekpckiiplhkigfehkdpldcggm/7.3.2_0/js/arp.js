var chrome=chrome||browser,isFirefox=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,default_options={};function acSwitch(e){const t=document.querySelectorAll(".ac-switch");function o(e){let t=e.getAttribute("rel");document.querySelectorAll(`.${t}`).forEach(e=>{e.disabled=!1})}function n(e){let t=e.getAttribute("rel");document.querySelectorAll(`.${t}`).forEach(e=>{e.disabled=!0})}t.length<1||t.forEach(t=>{t.classList.contains("active")?o(t):n(t),1==e&&t.addEventListener("click",()=>{t.classList.contains("active")?o(t):n(t)})})}function getId(e){return document.getElementById(e)}function readActiveData(e){return document.getElementById(e).classList.contains("active")?"true":"false"}function validateEmail(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())}function talkToBG(e,t){console.log("dadwasdawda");var o=isFirefox?chrome.runtime:chrome.extension;null==t?o.sendMessage({name:e},null):o.sendMessage({name:"save",data:e,value:t},null)}function save_options(){getId("default_time").value<0&&(getId("default_time").value=0);let e=getId("ea").value;if(e&&0==validateEmail(e))return alert("The email is not valid");console.log("ay"),talkToBG("default_time",getId("default_time").value),talkToBG("random_time",getId("randomTime").checked),talkToBG("autostart",readActiveData("autostart")),talkToBG("asurl",getId("as2").value),talkToBG("pdcheck",readActiveData("pdcheck")),talkToBG("pdurl",getId("pdurl").value),talkToBG("timercheck",readActiveData("timercheck")),talkToBG("rpt",readActiveData("rpt")),talkToBG("rpttext",getId("rpttext").value),talkToBG("asrestart",getId("asrestart").checked),talkToBG("pmemail",e),getId("timer01").checked?talkToBG("timermode","1"):talkToBG("timermode","2"),talkToBG("pmonitor",readActiveData("pmonitor")),talkToBG("defaultpgtxt",getId("defaultpgtxt").value),getId("pagemr01").checked?talkToBG("pmpattern","A"):talkToBG("pmpattern","B"),getId("pmsound01").checked?talkToBG("sound","1"):getId("pmsound02").checked?talkToBG("sound","2"):getId("pmsound03").checked?talkToBG("sound","3"):getId("pmsound04").checked&&talkToBG("sound","4"),talkToBG("soundurl",getId("soundurl").value),talkToBG("soundvolume",getId("soundvolume").value),getId("pm_sound_til_click").checked?talkToBG("pm_sound_til","click"):getId("pm_sound_til_sound").checked?talkToBG("pm_sound_til","sound"):getId("pm_sound_til_timeout").checked&&talkToBG("pm_sound_til","timeout"),talkToBG("pm_sound_timeout",getId("pm_sound_timeout").value),talkToBG("support",!document.getElementById("dontsupport").checked);let t=document.querySelector(".notification-success");t.style.display="block",setTimeout(()=>{t.style.display="none"},5e3)}function setActiveButton(e,t){let o=getId(e);t&&o.classList.add("active")}function fill_options(e){let t=e.storage;t.default_time&&(getId("default_time").value=t.default_time),getId("randomTime").checked="true"==t.random_time,setActiveButton("autostart","true"==t.autostart),setActiveButton("pdcheck","true"==t.pdcheck),setActiveButton("pmonitor","true"==t.pmonitor),setActiveButton("timercheck","true"==t.timercheck),setActiveButton("rpt","true"==t.rpt),getId("rpttext").value=t.rpttext||"",getId("asrestart").checked="true"==t.asrestart,getId("as2").value=t.asurl||"",getId("ea").value=t.pmemail||"",getId("defaultpgtxt").value=t.defaultpgtxt||"",t.timermode?"1"==t.timermode?getId("timer01").checked=!0:"2"==t.timermode&&(getId("timer02").checked=!0):getId("timer01").checked=!0,t.pmpattern&&"B"==t.pmpattern?getId("pagemr02").checked=!0:getId("pagemr01").checked=!0,t.sound&&"2"==t.sound?getId("pmsound02").checked=!0:t.sound&&"3"==t.sound?getId("pmsound03").checked=!0:t.sound&&"4"==t.sound?getId("pmsound04").checked=!0:getId("pmsound01").checked=!0,getId("soundvolume").value=t.soundvolume,getId("pdurl").value=t.pdurl||"",getId("soundurl").value=t.soundurl||"",t.pm_sound_til||(t.pm_sound_til="sound"),getId("pm_sound_til_"+t.pm_sound_til).checked=!0,getId("pm_sound_timeout").value=t.pm_sound_timeout||5,document.getElementById("dontsupport").checked="false"==t.support,acSwitch(!1)}function handleResponse(e){fill_options({storage:(e=>e.reduce((e,t)=>{const[o,n]=t;return e[o]=n,e},{}))(e)})}function handleError(e){console.warn("error: "+e)}function read_options(){isFirefox?chrome.runtime:chrome.extension;isFirefox?browser.runtime.sendMessage({name:"allOptions"}).then(handleResponse,handleError):chrome.extension.sendMessage({name:"allOptions"},e=>{fill_options(e)})}var volume_change_timer,volume_fadeout_timer,sound=new Audio,is_sound_playing=!1;function play_sound(){if(clearInterval(volume_fadeout_timer),getId("pmsound02").checked)var e=chrome.runtime.getURL("sound/sound1.mp3");else if(getId("pmsound03").checked)e=chrome.runtime.getURL("sound/sound2.mp3");else if(getId("pmsound04").checked)e=getId("soundurl").value;e&&(sound.src="",sound.volume=getId("soundvolume").value,sound.src=e,sound.play())}function addRel(e){let t=document.createElement("link");t.type="text/css",t.setAttribute("rel","stylesheet"),t.href=e,document.getElementsByTagName("head")[0].appendChild(t)}function pause_sound_with_fadeout(e){var t=e.volume;volume_fadeout_timer=setInterval(function(){t>0?(t-=.05,e.volume=Math.max(t,0)):(clearInterval(volume_fadeout_timer),e.pause())},16)}function init(){getId("test-play").onclick=play_sound;var e=document.getElementsByClassName("pmsound");[].forEach.call(e,function(e){e.onclick=play_sound}),getId("soundvolume").onchange=function(){sound.volume=this.value,sound.paused&&play_sound(),clearTimeout(volume_change_timer),volume_change_timer=setTimeout(function(){pause_sound_with_fadeout(sound)},2e3)},getId("incognito").onclick=function(){talkToBG("openIncognito",null)}}var arp_options={optionpage:()=>"/options"===window.location.pathname||"/options/"===window.location.pathname,injectOptionPage:()=>{addRel(chrome.runtime.getURL("/assets/css/style.min.css"));let e=document.querySelector("#arp-options");console.log(e),fetch(chrome.runtime.getURL("assets/template/options.html")).then(function(t){t.text().then(function(t){e.innerHTML=t,startI18n(),pageSetup(),acSwitch(!0),read_options(),$("#save").click(save_options),$("#cancel").click(function(){window.close()}),init()})}).catch(function(e){console.log("Error: "+e.message)})},init:()=>{arp_options.optionpage()&&arp_options.injectOptionPage();let e=document.querySelector(".section-cta");null!=e&&e.classList.add("installed");let t=document.querySelector(".active-btn");null!=e&&null!=t.childNodes[2]&&(t.childNodes[2].nodeValue="Installed");let o=document.querySelector(".setting-link");null!=o&&o.classList.remove("hide")}};document.addEventListener("DOMContentLoaded",function(e){arp_options.init()});const arp_alreadyInjected=document.documentElement.hasAttribute("data-arp-installed");arp_alreadyInjected||document.documentElement.setAttribute("data-arp-installed","true");