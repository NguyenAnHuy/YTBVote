var chrome=chrome||browser,isFirefox=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,tabs=new Array;function getCurrentTab(t){chrome.tabs.query({currentWindow:!0,active:!0,windowType:"normal"},function(e){t(e[0])})}function validateEmail(t){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(t).toLowerCase())}chrome.tabs.onUpdated.addListener((t,e,a)=>{void 0!==e.status&&"complete"===e.status&&chrome.tabs.executeScript(t,{file:"js/content.js",allFrames:!1},()=>{chrome.runtime.lastError,null!=localStorage.asrefresh&&"true"==localStorage.asrefresh&&arp.tabStart(a),null!=localStorage.rpt&&"true"==localStorage.rpt&&arp.rptStart(a)})});var arp={defaultValues:()=>{null==localStorage.pmonitor&&(localStorage.pmonitor="true"),null==localStorage.pmpattern&&(localStorage.pmpattern="A"),null==localStorage.sound&&(localStorage.sound="2"),null==localStorage.soundvolume&&(localStorage.soundvolume=1),null==localStorage.pm_sound_til&&(localStorage.pm_sound_til="sound"),null==localStorage.asrefresh&&(localStorage.asrefresh="true")},formatOptions:t=>{let e=!1,a="";return null!=t.track&&null!=t.track.ac&&"string"==typeof t.track.ac&&""!=t.track.ac&&(e=!0,a=t.track.ac),arp.global={track:e,trackAcc:a},arp.global},init:t=>{arp.defaultValues(),arp.autoStart();let e=arp.formatOptions(t);e.track&&arp.initTrack(e.trackAcc)},initTrack:t=>{var e=e||[];e.push(["_setAccount",t]),e.push(["_trackPageview"]),window._gaq=e,function(){var t=document.createElement("script");t.type="text/javascript",t.async=!1,t.src="https://ssl.google-analytics.com/ga.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()},parseUrl:(t,e=!1)=>(-1==t.search("http://")&&-1==t.search("https://")&&(t=new URL("http://"+t).href),"/"==(t=t.replace("www.","")).slice(-1)&&(t=t.replace(/.$/,"")),e&&(t=t.replace(/^https?:\/\//,"")),t),emailAlert:(t,e,a,r)=>{if(0==validateEmail(t))return;let o=new FormData,n="B"==r?"lost":"found";o.append("e",t),o.append("b",e),o.append("u",a),o.append("p",n),o.append("userId","1"),fetch("https://autorefresh.io/mail/",{method:"POST",body:o}).then(function(t){return t.text()}).then(function(t){console.log(t)}).catch(function(t){console.error(t)})},tabStart:t=>{if(null!=tabs[t.id])return;let e=localStorage.asurl;if("true"==localStorage.autostart&&e){let a=e.split(/\r?\n/),r=arp.parseUrl(t.url,!0);a.forEach((t,e)=>{a[e]=arp.parseUrl(t,!0)}),a.indexOf(r)>-1&&arp_loop(t,-1,arp.default_time(),"C","","",t.url)}},rptStart:t=>{if(null!=tabs[t.id])return;let e=localStorage.rpttext;e&&chrome.tabs.sendMessage(t.id,{pattern:"E",words:e},function(e){chrome.runtime.lastError,null!=e&&"yes"==e.predefinedText&&arp_loop(t,-1,arp.default_time(),"C","","",t.url)})},i18n:(t,e=null)=>{let a;return null==e&&(a=chrome.i18n.getMessage(t.toLowerCase())),null!=e&&(a=chrome.i18n.getMessage(t.toLowerCase(),e)),""==a?t:a},autoStart_open:(t,e)=>{chrome.tabs.create({url:t},a=>{arp_loop(a,-1,e,"C","","",t)})},default_time:()=>{let t=5e3;return localStorage.default_time&&(t=1e3*localStorage.default_time),t},autoStart:()=>{let t=localStorage.asurl;if("true"==localStorage.autostart&&t){let e=t.split(/\r?\n/);if("true"!=localStorage.asrestart)return;e.forEach(t=>{""!=t&&null!=t&&arp.autoStart_open(arp.parseUrl(t),arp.default_time())})}},Track:(t,e)=>{null!=arp.global&&_gaq.push(["_trackEvent",t,e])},trackErrors:t=>{console.error(t.stack),null!=arp.global&&_gaq.push(["_trackEvent",t.name,t.stack.toString()])}};try{arp.init({track:{ac:"UA-109860713-1"}})}catch(t){arp.trackErrors(t)}var extensionConnect=isFirefox?chrome.runtime:chrome.extension;extensionConnect.onMessage.addListener(function(t,e,a){if("openIncognito"==t.name){let t=isFirefox?"https://autorefresh.io/incognito#firefox":"chrome://extensions/?id="+chrome.runtime.id;chrome.tabs.create({url:t,active:!0})}else"save"==t.name?localStorage[t.data]=t.value:"allOptions"==t.name?a(isFirefox?Object.entries(localStorage):{storage:localStorage}):t.name}),extensionConnect.onConnect.addListener(function(t){"getOptions"===t.name&&t.onMessage.addListener(function(e){"getAllOptions"===e.msg&&getCurrentTab(function(e){(tabs[e.id]||!1)&&t.postMessage({status:tabs[e.id].status,time_interval:tabs[e.id].interval_time,time_type:tabs[e.id].time_type,checkme:tabs[e.id].checkme,wait_time:tabs[e.id].wait_time,openLink:tabs[e.id].openLink,inNewTab:tabs[e.id].inNewTab})})})});var RELOAD_LIMIT=10,counters={},pending_reloads={},blank_page=chrome.extension.getURL("blank.html");function updateTab(t,e){try{counters[t]=counters[t]||0,counters[t]+=1,chrome.tabs.update(t,{url:e})}catch(t){arp.trackErrors(t)}}function updateTabWithBlankSandwich(t,e){chrome.tabs.update(t,{url:blank_page})}function real_start(t,e){stopBadgeTimer(t),tabs[t].status="start",chrome.tabs.onUpdated.addListener(onUpdateListener),reload_it(t,e)}function get_rand_time(t,e){return Math.round(Math.random()*(e-t-0))+(t-0)}function arp_loop(t,e,a,r,o,n,s,i={}){if(null!=t){var l=t.id;if(chrome.tabs.sendMessage(l,{pattern:"C"},null),tabs[l]&&reload_cancel(t.id,"no"),tabs[l]=new Array,s?(tabs[l].pre_url=s,tabs[l].action_url=s):tabs[l].action_url=t.url,tabs[l].interval_time=a,"rand"==r){var u=a.split("-"),c=get_rand_time(u[0],u[1]);tabs[l].time_between_load=1e3*c}else if("timer"==r){let t=t=>parseInt(t)<10?"0"+t:t.toString();var d=a.split("-"),m=(t(d[0])+":"+t(d[1])+":"+t(d[2])).split(":"),p=60*+m[0]*60+60*+m[1]+ +m[2];tabs[l].time_between_load=1e3*p}else tabs[l].time_between_load=a;tabs[l].time_type=r,tabs[l].next_round=tabs[l].time_between_load/1e3,o&&(tabs[l].checkme=o,tabs[l].openLink=i.openLink,tabs[l].inNewTab=i.inNewTab),n&&(tabs[l].pmpattern=n),tabs[l].options=i,tabs[l].count=0;var b=tabs[l].action_url;if(-1==e)tabs[l].status="start",tabs[l].wait_time=0,tabs[l].wait_next_round=0,tabs[l].displayTimer&&stopBadgeTimer(l),real_start(l,b);else{tabs[l].wait_time=e;var _=0;e.toString().search(" ")>0?(tabs[l].status="wait",_=new Date(e).getTime()-(new Date).getTime(),tabs[l].wait_next_round=Math.floor(_/1e3)):(tabs[l].status="wait",_=e,tabs[l].wait_next_round=e/1e3),tabs[l].displayTimer=window.setInterval(function(t){tabs[t].wait_next_round--,setTimerBadgeText(t)},1e3,l),setTimeout(function(){real_start(l,b)},_)}}}function loop_start(t,e,a,r,o,n,s={}){getCurrentTab(function(i){try{arp_loop(i,t,e,a,r,o,n,s)}catch(t){arp.trackErrors(t)}})}function loop_stop(){getCurrentTab(function(t){if(null!=t)try{chrome.tabs.sendMessage(t.id,{pattern:"D"},null),reload_cancel(t.id,"no")}catch(t){arp.trackErrors(t)}})}function onUpdateListener(t,e,a){if(a.url!=blank_page&&(chrome.browserAction.setBadgeText({text:"",tabId:t}),tabs[t]&&"start"==tabs[t].status&&tabs[t].time_between_load>0||!1))if("loading"===e.status){var r=e.url||!1;tabs[t].pre_url?tabs[t].action_url=tabs[t].pre_url:r&&(tabs[t].action_url=r)}else if("complete"===e.status){if("rand"==tabs[t].time_type){var o=tabs[t].interval_time.split("-"),n=get_rand_time(o[0],o[1]);tabs[t].time_between_load=1e3*n}tabs[t].next_round=tabs[t].time_between_load/1e3,setTheBadgeText(t),setupReloadTimer(t),stopBadgeTimer(t),tabs[t].displayTimer=window.setInterval(function(t){tabs[t].next_round--,setTheBadgeText(t)},1e3,t)}}function setupReloadTimer(t){tabs[t].reloadTimer&&(clearTimeout(tabs[t].reloadTimer),tabs[t].reloadTimer=null),tabs[t].reloadTimer=window.setTimeout(function(t){reload_it(t,tabs[t].action_url)},tabs[t].time_between_load,t)}function stopBadgeTimer(t){tabs[t].displayTimer&&(clearTimeout(tabs[t].displayTimer),tabs[t].displayTimer=null)}function setTimerBadgeText(t){chrome.browserAction.setBadgeBackgroundColor({color:[0,128,0,255],tabId:t});var e=String(tabs[t].wait_next_round),a=tabs[t].wait_next_round%60,r=Math.floor(tabs[t].wait_next_round/60%60),o=Math.floor(tabs[t].wait_next_round/3600%24),n=Math.floor(tabs[t].wait_next_round/86400);if(n>999)e="9...";else if(n>9)e=String(n)+"d";else if(n>0)e=String(n)+"d"+String(o)+"h";else if(o>0){if(r<10&&(r="0"+String(r)),a%2)var s=":";else s=" ";e=String(o)+s+String(r)}else a<10&&(a="0"+String(a)),e=String(r)+":"+String(a);chrome.browserAction.setBadgeText({text:e,tabId:t})}function setTheBadgeText(t){if(tabs[t].next_round<0)chrome.browserAction.setBadgeText({text:String(),tabId:t},()=>{chrome.runtime.lastError}),stopBadgeTimer(t);else{var e=String(tabs[t].next_round),a=tabs[t].next_round%60,r=Math.floor(tabs[t].next_round/60%60),o=Math.floor(tabs[t].next_round/3600%24),n=Math.floor(tabs[t].next_round/86400);if(n>999)e="9...";else if(n>9)e=String(n)+"d";else if(n>0)e=String(n)+"d"+String(o)+"h";else if(o>0){if(r<10&&(r="0"+String(r)),a%2)var s=":";else s=" ";e=String(o)+s+String(r)}else a<10&&(a="0"+String(a)),e=String(r)+":"+String(a);chrome.browserAction.setBadgeText({text:e,tabId:t},()=>{chrome.runtime.lastError&&(stopBadgeTimer(t),clearTimeout(tabs[t].reloadTimer))})}}function show_notification(t,e,a,r){try{var o="B"==t?arp.i18n("lost"):arp.i18n("found"),n=/(..):(..)/.exec(new Date);n[1],n[1],arp.i18n("noti_msg_title"),arp.i18n("noti_msg"),arp.i18n("show_tab"),arp.i18n("dismiss");isFirefox?chrome.notifications.create(""+a,{type:"basic",title:o+" "+arp.i18n("noti_msg_title"),message:arp.i18n("noti_msg",o)+'"'+e+'" ',iconUrl:"Icon/icon-128.png"},()=>{}):chrome.notifications.create(""+a,{type:"basic",title:o+" "+arp.i18n("noti_msg_title"),message:arp.i18n("noti_msg",o)+'"'+e+'" ',iconUrl:"Icon/icon-128.png",buttons:[{title:arp.i18n("show_tab")},{title:arp.i18n("dismiss")}]},()=>{});var s="";localStorage.sound&&"2"==localStorage.sound?s="./sound/sound1.mp3":localStorage.sound&&"3"==localStorage.sound?s="./sound/sound2.mp3":localStorage.sound&&"4"==localStorage.sound&&(s=localStorage.soundurl?localStorage.soundurl:"./sound/sound1.mp3"),s&&(null==document.querySelector("audio")?startAudio(s):pause_sound_with_fadeout(document.querySelector("audio"),()=>{startAudio(s)}))}catch(t){arp.trackErrors(t)}}function pause_sound(t){null==t&&(t=document.querySelector("audio")),pause_sound_with_fadeout(t,null)}function startAudio(t){let e=document.createElement("audio");e.src=t,e.loop="sound"!=localStorage.pm_sound_til,e.volume=localStorage.soundvolume,document.documentElement.appendChild(e),e.play(),"timeout"==localStorage.pm_sound_til&&setTimeout(()=>{pause_sound()},1e3*localStorage.pm_sound_timeout||5e3)}function kill_sound(){pause_sound_with_fadeout(document.querySelector("audio"),null)}function pause_sound_with_fadeout(t,e){if(t){var a=t.volume;volume_fadeout_timer=setInterval(function(){a>0?(a-=.05,t.volume=Math.max(a,0)):(null!=t&&(clearInterval(volume_fadeout_timer),t.pause(),document.documentElement.removeChild(t)),null!=e&&e())},16)}}function reload_it(t,e){if(tabs[t].checkme){var a=tabs[t].checkme,r=tabs[t].pmpattern;if(0==tabs[t].count)updateTab(t,e);else{let o=tabs[t].openLink||!1,n=tabs[t].inNewTab||!1;chrome.tabs.sendMessage(t,{checkme:a,pattern:r,autoclick:o,inNewTab:n},function(o){null!=o&&("yes"==o.findresult?(reload_cancel(t,"yes"),chrome.tabs.update(t,{active:!0},t=>{}),chrome.tabs.get(t,function(n){chrome.windows.getLastFocused({},function(s){null!=o.url&&""!=o.url&&!0===tabs[t].openLink&&chrome.tabs.create({url:o.url}),show_notification(r,a,t,function(){chrome.tabs.update(t,{active:!0}),chrome.windows.update(n.windowId,{focused:!0})});var i=localStorage.pmemail;i&&arp.emailAlert(i,a,e,r)})})):(chrome.browserAction.setBadgeText({text:"",tabId:t}),updateTab(t,e)))})}}else chrome.browserAction.setBadgeText({text:"",tabId:t}),updateTab(t,e);tabs[t].count++}function reload_cancel(t,e){tabs[t].reloadTimer&&(clearTimeout(tabs[t].reloadTimer),tabs[t].reloadTimer=null),tabs[t].displayTimer&&(clearTimeout(tabs[t].displayTimer),tabs[t].displayTimer=null),tabs[t].status="stop",tabs[t].next_round=0,"yes"==e?chrome.browserAction.setBadgeText({text:"YES",tabId:t}):chrome.browserAction.setBadgeText({text:"",tabId:t})}chrome.tabs.onUpdated.addListener(function(t,e,a){e.url==blank_page&&pending_reloads[t]&&"loading"==e.status&&delete pending_reloads[t]}),chrome.notifications.onClicked.addListener(function(t){chrome.tabs.update(parseInt(t),{active:!0}),pause_sound()}),chrome.notifications.onButtonClicked.addListener(function(t,e){0==e&&chrome.tabs.update(parseInt(t),{active:!0}),pause_sound()}),chrome.notifications.onClosed.addListener(function(t,e){pause_sound()}),chrome.runtime.onInstalled.addListener(function(t){"install"==t.reason&&chrome.tabs.create({url:"https://autorefresh.io/options/?st=welcome"})}),chrome.runtime.setUninstallURL("https://autorefresh.io/uninstalled");