var chrome=chrome||browser,isFirefox=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;function getId(t){return document.getElementById(t)}function isodate(t){return t.toISOString().split("T")[0]}function changeClass(t,e,r,a){getId(t).classList.replace(r,a),setTimeout(()=>{getId(t).classList.replace(a,r)},1e3*e)}function openOptions(){let t=!1;chrome.tabs.getAllInWindow(void 0,function(e){e.forEach(e=>{e.url.search("https://autorefresh.io/options/")>=0&&(t=!0,chrome.tabs.update(e.id,{active:!0},null))}),t||window.open("https://autorefresh.io/options")})}var domainData={get(t){let e=localStorage["c_"+t];return null==e?void 0:JSON.parse(e)},set(t,e){localStorage["c_"+t]=e}};function domainParse(t){let e,r=t.toString(),a=(e=r.search("http://")>-1||r.search("https://")>-1?t:new URL("http://"+r).href).toString();return a=a.replace("www.","")}function conditionallyHideClearIcon(t){var e=t&&t.target||getId("contentid");document.querySelector(".hoverCloseContainer").style.display=e.value?"block":"none"}function get_interval(){var t=new Array,e=5e3,r=document.getElementsByName("reloadOption"),a=r.length;for(i=0;i<a;i++)if(r[i].checked)if("rand"==r[i].value){var n=$("#tmin").val()-0,o=$("#tmax").val()-0;e=n>o?o+"-"+n:n+"-"+o,t[0]=e,t[1]="rand"}else if("custom"==r[i].value){var s=$("#tcustom").val()-0;s<0?(e=1e3,$("#tcustom").val("1")):e=Math.round(1e3*s),t[0]=e,t[1]="custom"}else if("timer"==r[i].value){var l=$("#int_timerHour").val()-0,c=$("#int_timerMin").val()-0,d=$("#int_timerSec").val()-0;t[0]=l+"-"+c+"-"+d,t[1]="timer"}else e=r[i].value,t[0]=e,t[1]="stand";return t}function set_interval(t,e){if("custom"==e)return getId("r08").checked=!0,void(getId("tcustom").value=Math.floor(t/1e3));if("rand"==e){getId("r07").checked=!0;var r=t.split("-");return getId("tmin").value=r[0],void(getId("tmax").value=r[1])}if("timer"==e){getId("r10").checked=!0;r=t.split("-");return getId("int_timerHour").value=r[0],getId("int_timerMin").value=r[1],void(getId("int_timerSec").value=r[2])}var a=document.getElementsByName("reloadOption"),n=a.length;for(i=0;i<n;i++)if(a[i].value==t)return void(a[i].checked=!0)}function executeContentScript(){return new Promise((t,e)=>{null==localStorage.firstInstall?chrome.permissions.request({origins:["http://*/*","https://*/*"]},r=>{r?(localStorage.firstInstall="true",t()):e()}):chrome.permissions.contains({origins:["http://*/*","https://*/*"]},r=>{if(r)return t();chrome.permissions.request({origins:["http://*/*","https://*/*"]},r=>{r?t():e()})})})}function startRefresh(){executeContentScript().then(()=>{if("Start"==getId("startbtn").dataset.state){getId("startbtn").classList.add("btn-secondry"),getId("startbtn").innerHTML=chrome.i18n.getMessage("stop"),getId("startbtn").dataset.state="Stop",getId("timerbtn").dataset.state="Start Timer",getId("timerbtn").innerHTML=chrome.i18n.getMessage("start_timer"),getId("timerbtn").classList.remove("btn-secondry");var t=get_interval(),e=chrome.extension.getViews(),r=getId("contentid").value,a=getId("pgeMntrLink").checked,n=""==getId("pdurlinp").value?"":domainParse(getId("pdurlinp").value);let s={openLink:a,inNewTab:getId("pgeMntrLinkInNewTab").checked};for(var i in chrome.tabs.query({active:!0,currentWindow:!0},function(e){let n={};n.checkme=r,n.openLink=a,n.inNewTab=getId("pgeMntrLinkInNewTab").checked,n.time_type=t[1],n.time_interval=t[0];let i=JSON.stringify(n);"{}"!=i&&domainData.set(e[0].url,i)}),e)if(r){var o=getId("pmpattern").value;e[i].loop_start&&e[i].loop_start(-1,t[0],t[1],r,o,n,s)}else e[i].loop_start&&e[i].loop_start(-1,t[0],t[1],null,null,n,s)}else{getId("startbtn").dataset.state="Start",getId("startbtn").innerHTML=chrome.i18n.getMessage("start_msg"),getId("startbtn").classList.remove("btn-secondry");e=chrome.extension.getViews();for(var i in e)e[i].loop_stop&&e[i].loop_stop()}}).catch(t=>{console.log(t),alert("Host permissions are required")})}function startTimer(){if("Start Timer"==getId("timerbtn").dataset.state){var t=get_interval(),e=getId("contentid").value,r=""==getId("pdurlinp").value?"":"http://"+domainParse(getId("pdurlinp").value);if("1"==getId("timermode").value){var a=parseInt(getId("timerHour").value),n=parseInt(getId("timerMin").value),i=parseInt(getId("timerSec").value);if(isNaN(a)&&(a=0,getId("timerHour").value="0"),isNaN(n)&&(n=0,getId("timerMin").value="0"),isNaN(i)&&(i=0,getId("timerSec").value="0"),(p=1e3*(3600*a+60*n+i))<=0);else{var o=chrome.extension.getViews();for(var s in o)if(e){var l=getId("pmpattern").value;o[s].loop_start&&o[s].loop_start(p,t[0],t[1],e,l,r)}else o[s].loop_start&&o[s].loop_start(p,t[0],t[1],null,null,r);getId("timerbtn").dataset.state="Cancel Timer",getId("timerbtn").innerHTML=chrome.i18n.getMessage("cancel_timer"),getId("timerbtn").classList.add("btn-secondry"),getId("startbtn").dataset.state="Start",getId("startbtn").innerHTML=chrome.i18n.getMessage("start_msg"),getId("startbtn").classList.remove("btn-secondry")}}else{var c=getId("dateInp").value,d=new Date(c);if(isNaN(d))return;var g=c+" "+getId("timeInp").value,m=new Date(g);if(isNaN(m))return;if((new Date).getTime()>=m.getTime());else{var u=m.getMonth()+1,p=(d=m.getFullYear()+"/"+u+"/"+m.getDate())+" "+(m=m.getHours()+":"+m.getMinutes()+":"+m.getSeconds());o=chrome.extension.getViews();for(var s in o)if(e){l=getId("pmpattern").value;o[s].loop_start&&o[s].loop_start(p,t[0],t[1],e,l,r)}else o[s].loop_start&&o[s].loop_start(p,t[0],t[1],null,null,r);getId("timerbtn").dataset.state="Cancel Timer",getId("timerbtn").innerHTML=chrome.i18n.getMessage("cancel_timer"),getId("timerbtn").classList.add("btn-secondry"),getId("startbtn").dataset.state="Start",getId("startbtn").innerHTML=chrome.i18n.getMessage("start_msg"),getId("startbtn").classList.remove("btn-secondry")}}}else{getId("timerbtn").dataset.state="Start Timer",getId("timerbtn").innerHTML=chrome.i18n.getMessage("start_timer"),getId("timerbtn").classList.remove("btn-secondry");o=chrome.extension.getViews();for(var s in o)o[s].loop_stop&&o[s].loop_stop()}}function killSoundsMonitor(){changeClass("mutedBtn",.55,"icon-unmute","icon-mute");var t=chrome.extension.getViews();for(var e in t)t[e].kill_sound&&t[e].kill_sound()}function restoreOptions(){if(localStorage.default_time&&set_interval(1e3*localStorage.default_time,"custom"),localStorage.defaultpgtxt&&localStorage.defaultpgtxt.length>0&&(getId("useDefault").style.display="inline-block"),"true"==localStorage.random_time&&$("#randombox").css("display","flex"),localStorage.pmonitor&&"true"==localStorage.pmonitor&&($("#monitorbox").show(),localStorage.pmpattern&&"B"==localStorage.pmpattern?($("#pagemr02").show(),$("#pagemr01").hide(),$("#pmpattern").val("B")):($("#pagemr02").hide(),$("#pagemr01").show(),$("#pmpattern").val("A"))),localStorage.pdcheck&&"true"==localStorage.pdcheck){$("#pdurlbox").show();var t=localStorage.pdurl;$("#pdurlinp").val(t)}if(localStorage.timercheck&&"true"==localStorage.timercheck)if("1"==localStorage.timermode)$("#timerbox").show(),$("#timermode").val("1");else{$("#timermode").val("2"),$("#timerboxdate").show(),getId("timerbtn").id="none",getId("timerbtn2").id="timerbtn",$("#timerbtn").click(startTimer);var e=new Date((new Date).getTime()+6e5),r=e.getMonth()+1;let t=e.getHours(),i=e.getMinutes(),o=e.getSeconds();r<10&&(r="0"+r),t<10&&(t="0"+t),i<10&&(i="0"+i),o<10&&(o="0"+o);var a=e.getFullYear()+"-"+r+"-"+e.getDate(),n=t+":"+i+":"+o;$("#dateInp").val(a),$("#timeInp").val(n)}var i=chrome.runtime.connect({name:"getOptions"});i.onMessage.addListener(recvData),chrome.tabs.query({active:!0,currentWindow:!0},function(t){let e=domainData.get(t[0].url);if(null!=e){let t="rand"!=e.time_type;t||(t="true"==localStorage.random_time),dynamicOptions(e,t)}i.postMessage({msg:"getAllOptions"})})}function dynamicOptions(t,e){e&&set_interval(t.time_interval,t.time_type),t.checkme&&(getId("contentid").value=t.checkme,t.openLink&&(getId("pgeMntrLink").checked=t.openLink),t.inNewTab&&(getId("pgeMntrLinkInNewTab").checked=t.inNewTab))}function recvData(t){if("start"==t.status?(getId("startbtn").dataset.state="Stop",getId("startbtn").innerHTML=chrome.i18n.getMessage("stop"),getId("startbtn").classList.add("btn-secondry")):"wait"==t.status?(getId("timerbtn").dataset.state="Cancel Timer",getId("timerbtn").innerHTML=chrome.i18n.getMessage("cancel_timer"),getId("timerbtn").classList.add("btn-secondry")):(getId("startbtn").dataset.state="Start",getId("startbtn").innerHTML=chrome.i18n.getMessage("start_msg"),getId("startbtn").classList.remove("btn-secondry"),getId("timerbtn").dataset.state="Start Timer",getId("timerbtn").innerHTML=chrome.i18n.getMessage("start_timer"),getId("timerbtn").classList.remove("btn-secondry")),dynamicOptions(t,!0),t.wait_time)if(-1==t.wait_time.toString().search(" ")){var e=t.wait_time/1e3,r=Math.floor(e/3600),a=Math.floor((e-3600*r)/60),n=Math.floor(e-3600*r-60*a);getId("timerHour").value=r,getId("timerMin").value=a,getId("timerSec").value=n,$("#timermode").val("1")}else{var i=new Date(t.wait_time),o=i.getMonth()+1;o<10&&(o="0"+o);var s=i.getDate()+1;s<10&&(s="0"+s);var l=i.getMinutes()+1;l<10&&(l="0"+l);var c=i.getSeconds()+1;c<10&&(c="0"+c);let e=i.getHours();e<10&&(e="0"+e);var d=i.getFullYear()+"-"+o+"-"+i.getDate(),g=e+":"+l+":"+c;$("#dateInp").val(d),$("#timeInp").val(g),$("#timermode").val("2")}}$(document).ready(function(){setTimeout(restoreOptions,1),getId("r08").checked=!0,$("#useDefault").click(()=>{getId("contentid").value=localStorage.defaultpgtxt}),$("#startbtn").click(startRefresh),$("#r08").click(function(){getId("tcustom").focus()}),$("#tcustom").focus(function(){getId("r08").checked=!0}),$("#r07").click(function(){getId("tmin").focus()}),$("#tmin").focus(function(){getId("r07").checked=!0}),$("#tmax").focus(function(){getId("r07").checked=!0});var t=new Date;t.setDate(t.getDate()),getId("dateInp").setAttribute("min",isodate(t)),$("#mutedBtn").click(killSoundsMonitor),$("#timerbtn").click(startTimer),getId("contentid").addEventListener("input",conditionallyHideClearIcon),document.querySelector(".hoverCloseContainer").addEventListener("click",t=>{getId("contentid").value="",conditionallyHideClearIcon()}),$("#advancedOptions").click(()=>{openOptions()})});var scrollRoot=document.body,header=getId("header"),is_scrolling=!0;function update(){is_scrolling&&(scrollRoot.scrollTop?header.classList.add("scrolled"):header.classList.remove("scrolled"),is_scrolling=!1),requestAnimationFrame(update)}update(),document.onscroll=function(){is_scrolling=!0},"B"==localStorage.pmpattern?getId("autoClk").style.display="none":getId("autoClk").style.display="flex";